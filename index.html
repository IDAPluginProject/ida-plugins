<!DOCTYPE html>
<html lang="en">
	<!-- TODO: massive work in progress; very experimental at the moment -->
	<head>
		<meta charset="utf-8"/>
		<link href="lib/tabulator.min.css" rel="stylesheet">
		<title>Interactive IDA Plugin List</title>
		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
				font-size: 12px
			}
			.no-underline a {
				text-decoration: none;
			}
			.no-underline a:hover {
				text-decoration: underline;
			}
		</style>

	</head>
	<body>
		<h1>Interactive IDA Plugin List</h1>
		<p></p>
		<h1>WORK IN PROGRESS</h1>
		See <a href="https://github.com/vmallet/ida-plugins">source</a>
		<p></p>
		<div>
			<span>
				<!-- Hardcoded at the moment; should generate from the data we have -->
				<label>Source:&nbsp;</label>
				<input type="checkbox" id="src-cpp" name="src-cpp" value="c++"/>
		  		<label for="src-cpp">c++</label>
				<input type="checkbox" id="src-py" name="src-py" value="py"/>
		  		<label for="src-py">py</label>

				<!-- Please help me make a half-decent webpage! -->
				&nbsp;&nbsp;&nbsp;&nbsp;
				<label>Categories:&nbsp;</label>
				<input type="checkbox" id="cats-debug" name="cats-debug" value="debug"/>
		  		<label for="cats-debug">debug</label>
				<input type="checkbox" id="cats-decomp" name="cats-decomp" value="decomp"/>
		  		<label for="cats-decomp">decomp</label>
				<input type="checkbox" id="cats-deobf" name="cats-deobf" value="deobf"/>
		  		<label for="cats-deobf">deobf</label>
				<input type="checkbox" id="cats-loader" name="cats-loader" value="loader"/>
		  		<label for="cats-loader">loader</label>
				<input type="checkbox" id="cats-proc" name="cats-proc" value="proc"/>
		  		<label for="cats-proc">proc</label>
				<input type="checkbox" id="cats-ui" name="cats-ui" value="ui"/>
		  		<label for="cats-ui">ui</label>
			</span>
		</div>
		<p></p>
		<div class="no-underline">
			<div id="plugin-table"><i>Loading...</i></div>
		</div>

		<script type="text/javascript" src="lib/moment.min.js"></script>
		<script type="text/javascript" src="lib/tabulator.min.js"></script>
		<script type="text/javascript" src="lib/jquery-3.6.0.slim.min.js"></script>
		<script type="text/javascript" src="data.js"></script>

		<script type="text/javascript">
	let table = new Tabulator("#plugin-table", {
		data:tabledata, //load initial data into table
		layout:"fitColumns", //fit columns to width of table (optional)
		columns:[ //Define Table Columns
			{title:"Name", field: "name", sorter: "string", formatter:"link", hozAlign:"left",
				formatterParams: {urlField: "url", labelField: "name", target: "_blank"}, width: 150},
			{title:"Desc", field:"desc", sorter:"string", formatter: "textarea", hozAlign:"left"},
			{title:"Cat", field:"cats", sorter:"string", formatter: "textarea", hozAlign:"left", width: 100},
			{title:"Src", field:"src", sorter:"string", formatter: "plaintext", hozAlign:"left", width: 50},
			{title:"Updated", field:"last", sorter:"string", formatter:function(cell, params, onRendered){
					if (!cell.getValue()) {
						return "";
					}
			        return moment(cell.getValue(), "YYYYMMDD").fromNow();
			    },
				hozAlign:"left", width: 120}
		],
	});

	/** Src filter. */
	let src = [];
	const src_checkboxes = [ "#src-cpp", "#src-py" ];

	/** Category filter. */
	let cats = [];
	const cats_checkboxes = [
			"#cats-deobf", "#cats-decomp", "#cats-loader", "#cats-debug",
			"#cats-proc", "#cats-ui" ];

	/**
	 * Filter a table row.
	 */
	function customFilter(data) {
		if (src.length && !src.includes(data.src)) {
			return false;
		}
		// Note: this one only works because it is the last one in the chain.
		if (cats.length) {
			if (!data.cats) {
				return false;
			}
			for (const cat of cats) {
				if (data.cats.includes(cat)) {
					return true;
				}
			}
			return false;
		}
		return true;
	}

	/**
	 * Return the values associated with the checked checkboxes from the set
	 * of checkboxes identified by ids.
	 *
	 * @param ids ids of checkboxes
	 * @returns {[]} a list of values, possibly empty
	 */
	function getCheckedValues(ids) {
		vals = [];
		for (const id of ids) {
			let cb = $(id);
			if (cb.is(':checked')) {
				vals.push(cb.val());
			}
		}
		return vals;
	}

	/**
	 * React to a filter-setup change and update the active filter accordingly.
	 */
	function updateFilter() {
		src = getCheckedValues(src_checkboxes);
		cats = getCheckedValues(cats_checkboxes);

		if (src.length || cats.length) {
			table.setFilter(customFilter);
		} else {
			table.clearFilter();
		}
		// A bit of a mystery why the table needs to be redrawn. Chalk it to my
		// lack of knowledge here...
		table.redraw();
	}

	/**
	 * Make sure the elements corresponding to the given ids update the
	 * filter on change.
	 */
	function registerUpdate(ids) {
		for (const id of ids) {
			$(id).change(updateFilter);
		}
	}

	registerUpdate(src_checkboxes);
	registerUpdate(cats_checkboxes);
		</script>

		<p>Author: <a href="https://github.com/vmallet">Vincent Mallet</a></p>
	</body>
</html>
